---
title: 服务器自动化部署
date: "2020-08-08"
sidebar: "auto"
coverImg: /blog/8.png
description: "本地 vitepress 自动化部署到云服务器"
---

# 服务器自动化部署

:::tip
本地 vitepress 自动化部署到云服务器
:::

平常我们项目进行部署时，大多数仅仅是以测试为目的（或者说项目内容不会有频繁的改动），因此使用 FTP 文件传输工具（如：FileZilla）即可满足我们的需求。

但对于需要频繁改动的项目部署（如我的个人笔记库网站：https://euphoria-mzh.love/ ），自动化部署就显得尤为重要。

## 安装三方包

```sh
npm i scp2
```

- 如有报错运行`npm audit fix` package.json 显示 scp2 包信息即可

## 使用方式

- 项目根目录新建 upload.ssh.js 文件，其内容如下：

```js
"use strict";
// 引入scp2var
var client = require("scp2");
console.log("开始自动上传!");
client.scp(
  "./docs/.vuepress/dist/", // 默认打包的路径
  {
    host: "", // 此处替换为你自己服务器的ip
    port: "22", // ftp端口号 ，一般为22 或 21
    username: "root", // 服务器登录用户名
    password: "", // 服务器登录密码
    path: "/www/wwwroot/……/", // 项目要上传到服务器的路径，要服务器上的绝对路径
  },
  (err) => {
    if (!err) {
      console.log("项目发布完毕!");
    } else {
      console.log("err", err);
    }
  }
);
```

- 在 package.json scripts 对象 中添加运行命令

```js{5-6}
{
  "scripts": {
    "dev": "vuepress dev docs",
    "build": "vuepress build docs",
    "upload": "node upload.ssh.js",
    "deploy": "npm run build && npm run upload"
  },
}
```

- 等待控制台输出项目发布完毕即可

```sh
开始自动上传!
项目发布完毕!
```
